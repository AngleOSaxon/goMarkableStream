<!DOCTYPE html>
<html>
	<head>
		<title>Responsive Container Example</title>
		<style>
/* CSS styles for the layout */
body, html {
	margin: 0;
	padding: 0;
	height: 100%;
}

	#container {
		position: relative;
		width: 100%;
		height: 100%;
		display: flex;
		align-items: center;
		justify-content: center;
		overflow: hidden;
	}

	#canvas {
		max-width: 100%;
		max-height: 100%;
	}

	canvas.hidden {
		display: none;
	}
		</style>
	</head>
	<body>
		<canvas id="fixedCanvas" width="1872" height="1404" class="hidden"></canvas>
		<div id="container">
			<canvas id="canvas" width="1872" height="1404"></canvas>
		</div>

		<script>
			// Use the fixed-size canvas context to draw on the canvas
			var fixedCanvas = document.getElementById("fixedCanvas");
			var fixedContext = fixedCanvas.getContext("2d");
			var resizableCanvas = document.getElementById("canvas");
			var resizableContext = resizableCanvas.getContext("2d");
			function copyCanvasContent() {
				resizableContext.drawImage(fixedCanvas, 0, 0, resizableCanvas.width, resizableCanvas.height);
			}

			// Set the rotation angle in degrees
			//const rotationAngle = 270;

			// Translate the canvas to the center point
			//resizableContext.translate(resizableCanvas.width / 2, resizableCanvas.height / 2);

			// Rotate the canvas by the specified angle
			//resizableContext.rotate((rotationAngle * Math.PI) / 180);


			// JavaScript code for working with the canvas element
			function resizeCanvas() {
				var canvas = document.getElementById("canvas");
				var container = document.getElementById("container");

				var aspectRatio = 1872 / 1404;

				var containerWidth = container.offsetWidth;
				var containerHeight = container.offsetHeight;

				var containerAspectRatio = containerWidth / containerHeight;

				if (containerAspectRatio > aspectRatio) {
					canvas.style.width = containerHeight * aspectRatio + "px";
					canvas.style.height = containerHeight + "px";
				} else {
					canvas.style.width = containerWidth + "px";
					canvas.style.height = containerWidth / aspectRatio + "px";
				}

				// Use the canvas context to draw on the canvas
				copyCanvasContent();
			}

			// Resize the canvas whenever the window is resized
			window.addEventListener("resize", resizeCanvas);

			// Initial call to resize the canvas
			//resizeCanvas();
			var socket = new WebSocket("ws://" + window.location.host + "/ws");



			socket.onopen = function() {
				console.log("WebSocket connection established.");
			};

			socket.onmessage = function(event) {
				var blob = event.data; // Received binary data as a Blob

				var reader = new FileReader();
				reader.onload = function() {
					var arrayBuffer = reader.result; // ArrayBuffer representation of the Blob data

					// Process the received binary data
					processBinaryData(arrayBuffer);
				};
				reader.readAsArrayBuffer(blob);
			};
			function processBinaryData(data) {

				// Assuming each pixel is represented by 4 bytes (RGBA)
				var pixels = new Uint8Array(data);
				// Create an ImageData object with the byte array length
				var imageData = fixedContext.createImageData(fixedCanvas.width, fixedCanvas.height);
				// Assign the byte array values to the ImageData data property
				for (var i = 0; i < pixels.length; i++) {
					imageData.data[i*4] = pixels[i] * 17;
					imageData.data[i*4+1] = pixels[i] * 17;
					imageData.data[i*4+2] = pixels[i] * 17;
					imageData.data[i*4+3] = 255;
				}

				// Display the ImageData on the canvas
				fixedContext.putImageData(imageData, 0, 0);


				copyCanvasContent();
			};

			socket.onerror = function(event) {
				console.log(event);
			}
			socket.onclose = function(event) {
				console.log("WebSocket connection closed with code: " + event.code);
				console.log("WebSocket connection closed with code: " + event);
			};

		</script>
	</body>
</html>
